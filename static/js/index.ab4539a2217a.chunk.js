import{o as g,r as m,ar as T,j as e,T as b,B as w,k as d,ah as h,cz as y,bh as _,ao as O,a9 as F,bs as L,cB as W,an as U,aH as A,cQ as G,cR as K,cS as k,cT as v,cU as C,aG as j,aj as Q,F as R,bO as V,by as H,bz as $,bA as z,cM as E,cN as N}from"./vendor.83d59a4358fc.chunk.js";import{j as M,M as x,J as D,K as J,N as I,O as X,P as Z,E as ee,i as re,Q as ae,b as ne}from"./index.8aebe18ecbfa.js";import{K as P}from"./KeyValueTable.406c0a7c3b2d.chunk.js";import{c as te,a as S,b as oe,F as q,e as ie}from"./formik.esm.c705069f060a.chunk.js";import{L as Y}from"./LoadingButton.9f9fe5846379.chunk.js";import{M as se}from"./Masonry.61ecbf43fc9f.chunk.js";const ce=()=>{const{t:r}=g(),{data:a,isLoading:t}=M(),u=m.useMemo(()=>{var s,c,l;return[{key:r("profile.account-info-card.table.email",{context:"key"}),value:r("profile.account-info-card.table.email",{context:"value",email:a==null?void 0:a.email})},{key:r("profile.account-info-card.table.plan_id",{context:"key"}),value:r("profile.account-info-card.table.plan_id",{context:"value",count:(s=a==null?void 0:a.plan_id)!=null?s:0})},{key:r("profile.account-info-card.table.plan_expired_at",{context:"key"}),value:r("profile.account-info-card.table.plan_expired_at",{context:"value",date:T.unix((c=a==null?void 0:a.expired_at)!=null?c:0).format("YYYY-MM-DD HH:mm")})},{key:r("profile.account-info-card.table.created_at",{context:"key"}),value:r("profile.account-info-card.table.created_at",{context:"value",date:T.unix((l=a==null?void 0:a.created_at)!=null?l:0).format("YYYY-MM-DD HH:mm")})}].map(n=>({key:e(b,{noWrap:!0,children:n.key}),value:e(b,{noWrap:!0,children:n.value})}))},[a,r]);return e(x,{title:r("profile.account-info-card.title"),children:e(P,{data:u,isValueLoading:t})})},le=()=>{const{t:r}=g(),{data:a,isLoading:t}=M(),u=m.useMemo(()=>{var s,c,l,n;return[{key:r("profile.wallet-card.table.balance",{context:"key"}),value:r("profile.wallet-card.table.balance",{context:"value",value:(((s=a==null?void 0:a.balance)!=null?s:0)/100).toFixed(2),count:((c=a==null?void 0:a.balance)!=null?c:0)/100})},{key:r("profile.wallet-card.table.commission_balance",{context:"key"}),value:r("profile.wallet-card.table.commission_balance",{context:"value",value:(((l=a==null?void 0:a.commission_balance)!=null?l:0)/100).toFixed(2),count:((n=a==null?void 0:a.commission_balance)!=null?n:0)/100})}].map(o=>({key:e(b,{noWrap:!0,children:o.key}),value:e(b,{noWrap:!0,children:o.value})}))},[a,r]);return e(x,{title:r("profile.wallet-card.title"),children:e(P,{data:u,isValueLoading:t})})},de={old_password:"",new_password:"",confirm_password:"",submit:null},pe=()=>{const{t:r}=g(),a=D(),[t]=J(),u=m.useMemo(()=>te({old_password:S().required(r("profile.change-password-card.form.old_password",{context:"required"}).toString()),new_password:S().required(r("profile.change-password-card.form.new_password",{context:"required"}).toString()).min(8,r("profile.change-password-card.form.new_password",{context:"min",count:8}).toString()),confirm_password:S().required(r("profile.change-password-card.form.confirm_password",{context:"required"}).toString()).oneOf([oe("new_password")],r("profile.change-password-card.form.confirm_password",{context:"not_match"}).toString())}),[r]),s=m.useCallback(async(c,{setSubmitting:l,setStatus:n,setErrors:o})=>{try{await t(c).unwrap(),n({success:!0}),a(I())}catch(p){const i=p;console.error("Error changing password",i),n({success:!1,message:i.message}),o(i.errors||{submit:i.message})}finally{l(!1)}},[t,a]);return e(x,{title:r("profile.change-password-card.title"),children:e(q,{initialValues:de,validationSchema:u,onSubmit:s,children:({handleChange:c,handleBlur:l,handleSubmit:n,errors:o,touched:p,isSubmitting:i,values:f})=>e(w,{component:"form",onSubmit:n,children:d(h,{spacing:2,children:[e(y,{type:"password",id:"old_password-label",name:"old_password",label:r("profile.change-password-card.form.old_password",{context:"label"}),value:f.old_password,onChange:c,onBlur:l,error:Boolean(p.old_password&&o.old_password),helperText:p.old_password&&o.old_password,disabled:i,fullWidth:!0}),e(y,{type:"password",id:"new_password-label",name:"new_password",label:r("profile.change-password-card.form.new_password",{context:"label"}),value:f.new_password,onChange:c,onBlur:l,error:Boolean(p.new_password&&o.new_password),helperText:p.new_password&&o.new_password,disabled:i,autoComplete:"new-password",fullWidth:!0}),e(y,{type:"password",id:"confirm_password-label",name:"confirm_password",label:r("profile.change-password-card.form.confirm_password",{context:"label"}),value:f.confirm_password,onChange:c,onBlur:l,error:Boolean(p.confirm_password&&o.confirm_password),helperText:p.confirm_password&&o.confirm_password,disabled:i,autoComplete:"new-password",fullWidth:!0}),d(h,{direction:"row",justifyContent:"space-between",children:[e(w,{children:e(b,{variant:"caption",color:"error",noWrap:!0,children:o.submit})}),d(h,{direction:"row",justifyContent:"flex-end",spacing:2,children:[e(_,{type:"reset",variant:"outlined",disabled:i,children:r("profile.change-password-card.form.reset-button")}),e(_,{type:"submit",variant:"contained",disabled:i,children:i?e(O,{size:16}):r("profile.change-password-card.form.submit-button")})]})]})]})})})})},ue=()=>{const{t:r}=g(),{data:a,isLoading:t}=M(),[u]=X(),{enqueueSnackbar:s}=F(),c=m.useMemo(()=>({remind_expire:(a==null?void 0:a.remind_expire)===1,remind_traffic:(a==null?void 0:a.remind_traffic)===1}),[a]),l=m.useCallback(async(n,{setSubmitting:o,setStatus:p,setErrors:i})=>{try{await u({remind_expire:n.remind_expire?1:0,remind_traffic:n.remind_traffic?1:0}).unwrap(),p({success:!0}),s(r("notice::update-user",{context:"success"}),{variant:"success"})}catch(f){p({success:!1}),i(f.errors||{submit:f.message})}finally{o(!1)}},[s,r]);return e(x,{title:r("profile.notification-card.title"),children:e(q,{initialValues:c,onSubmit:l,enableReinitialize:!0,children:({values:n,handleChange:o,handleSubmit:p,handleBlur:i,isSubmitting:f})=>e(w,{component:ie,onSubmit:p,children:d(h,{spacing:2,children:[e(L,{control:e(W,{}),name:"remind_expire",checked:n.remind_expire,disabled:t||f,onChange:o,onBlur:i,label:r("profile.notification-card.expired_notify",{context:"label"}),labelPlacement:"end",sx:{m:0}}),e(L,{control:e(W,{}),name:"remind_traffic",checked:n.remind_traffic,disabled:t||f,onChange:o,onBlur:i,label:r("profile.notification-card.traffic_notify",{context:"label"}),labelPlacement:"end",sx:{m:0}}),e(h,{direction:"row",justifyContent:"flex-end",children:e(Y,{variant:"contained",type:"submit",loading:t||f,children:r("profile.notification-card.save-button")})})]})})})})},B=2,fe=()=>{const{t:r}=g(),{data:a}=Z(),{data:t}=ee(),{data:u}=re(),s=m.useMemo(()=>U,[r]),[c,l]=A("telegram_card_init",{defaultValue:0}),[n,{inc:o,dec:p}]=G(c,{min:0,max:B});m.useEffect(()=>{l(n)},[n]);const i=m.useMemo(()=>()=>d(h,{direction:"row",spacing:1,mt:2,children:[e(_,{onClick:()=>o(),variant:"contained",disabled:n>=B,children:r("profile.telegram-card.next_step")}),e(_,{onClick:()=>p(),variant:"text",disabled:n<=0,children:r("profile.telegram-card.previous_step")})]}),[r,n]);return e(x,{title:r("profile.telegram-card.title"),children:d(K,{activeStep:n,orientation:"vertical",children:[d(k,{children:[e(v,{children:e(b,{variant:"subtitle1",children:r("profile.telegram-card.add_bot",{context:"label"})})}),d(C,{children:[e(w,{children:e(s,{i18nKey:"profile.telegram-card.add_bot",tOptions:{context:"content",name:a==null?void 0:a.username},children:e(j,{href:`https://t.me/${a==null?void 0:a.username}`,target:"_blank"})})}),e(i,{})]})]}),d(k,{children:[e(v,{children:e(b,{variant:"subtitle1",children:r("profile.telegram-card.send_command",{context:"label"})})}),d(C,{children:[e(w,{children:e(s,{i18nKey:"profile.telegram-card.send_command",tOptions:{context:"content"},children:{command:`/bind ${u==null?void 0:u.subscribe_url}`}})}),e(i,{})]})]}),d(k,{children:[e(v,{children:e(b,{variant:"subtitle1",children:r("profile.telegram-card.add_to_group",{context:"label"})})}),d(C,{children:[e(w,{children:e(b,{children:e(s,{i18nKey:"profile.telegram-card.add_to_group",tOptions:{link:t==null?void 0:t.telegram_discuss_link,context:"content"},children:e(j,{href:t==null?void 0:t.telegram_discuss_link,target:"_blank",rel:"noreferrer"})})})}),e(i,{})]})]})]})})},me=()=>{const{t:r}=g(),[a,{setLeft:t,setRight:u}]=Q(!1),{enqueueSnackbar:s}=F(),[c,{isLoading:l}]=ae(),n=m.useCallback(async()=>{try{await c().unwrap(),s(r("notice::reset-security",{context:"success"}),{variant:"success"})}catch(o){console.error(o),s(r("notice::reset-security",{context:"failed"}),{variant:"error"})}finally{t()}},[c,s,r,t]);return d(R,{children:[e(x,{title:r("profile.reset-subscription-card.title"),children:d(h,{spacing:2,children:[e(V,{severity:"warning",children:r("profile.reset-subscription-card.alert")}),e(_,{variant:"contained",color:"error",fullWidth:!0,onClick:u,children:r("profile.reset-subscription-card.button")})]})}),d(H,{open:a,onClose:t,"aria-labelledby":"form-dialog-title",children:[e($,{id:"form-dialog-title",children:r("profile.reset-subscription-card.dialog.title")}),e(z,{children:e(E,{children:r("profile.reset-subscription-card.dialog.content")})}),d(N,{children:[e(_,{onClick:t,color:"primary",children:r("profile.reset-subscription-card.dialog.cancel")}),e(Y,{onClick:n,color:"error",loading:l,children:r("profile.reset-subscription-card.dialog.confirm")})]})]})]})},be=()=>d(se,{spacing:2,columns:{xs:1,md:2,xl:3},children:[e(ce,{}),e(le,{}),e(pe,{}),e(ue,{}),e(fe,{}),e(me,{})]}),ke=()=>(ne("profile"),e(be,{}));export{ke as default};
