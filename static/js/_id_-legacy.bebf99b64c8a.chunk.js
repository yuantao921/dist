System.register(["./vendor-legacy.fc156c611c90.chunk.js","./index-legacy.eddd011a9de2.js","./constate.es-legacy.2206c0daac28.chunk.js","./order-legacy.246da77bf9e0.chunk.js","./plan-legacy.bc306d90a96a.chunk.js"],(function(e,r){"use strict";var t,c,a,n,o,d,i,l,s,u,h,m,p,b,f,g,v,k,y,N,x,E,_,I,M,S,D,w,L,Y,A,C,P,F,H,G,j,R,T,O,q,z,W,J,K,Q;return{setters:[e=>{t=e.o,c=e.a9,a=e.r,n=e.ar,o=e.j,d=e.aJ,i=e.k,l=e.bI,s=e.cI,u=e.cJ,h=e.cK,m=e.ah,p=e.T,b=e.aj,f=e.cL,g=e.F,v=e.av,k=e.ai,y=e.ce,N=e.by,x=e.bz,E=e.a7,_=e.bA,I=e.cM,M=e.cN,S=e.bh,D=e.b0,w=e.cO,L=e.H,Y=e.af,A=e.q,C=e.v,P=e.as,F=e.bV},e=>{H=e.w,G=e.x,j=e.y,R=e.M,T=e.m,O=e.v,q=e.A,z=e.z,W=e.b},e=>{J=e.c},e=>{K=e.O},e=>{Q=e.a}],execute:function(){const[r,U]=J((({tradeNo:e})=>{const{t:r}=t(),{enqueueSnackbar:n}=c(),[o,d]=a.useState(K.PENDING),[i,l]=a.useState(!1),s=H(e),u=G(e,{skip:o!==K.PENDING&&o!==K.PAID||!s.isSuccess,pollingInterval:1e3}),h=j(void 0,{skip:o!==K.PENDING||!s.isSuccess}),[m,p]=a.useState(0),b=a.useMemo((()=>new Map(h.data?.map((e=>[e.id,e])))),[h.data]);return a.useEffect((()=>{0===m&&h.isSuccess&&p(h.data[0].id)}),[h.isSuccess,m,h.data]),a.useEffect((()=>{s.data?.status&&d(s.data.status)}),[s.data?.status]),a.useEffect((()=>{u.data&&d(u.data)}),[u.data]),a.useEffect((()=>{s.error&&n(r("notice::order-detail-error",{error:s.error.message}),{variant:"error"})}),[s.error]),{tradeNo:e,status:o,detail:s,callback:u,paymentMethod:h,paymentMethodIndex:b,paymentMethodState:m,setPaymentMethodState:p,isSubmitting:i,setSubmitting:l}})),V=()=>{const{t:e}=t(),{detail:{data:r,isLoading:c}}=U(),s=a.useMemo((()=>{const e=n.unix(r?.created_at||0);switch(r?.period){case Q.MONTHLY:return e.add(1,"month");case Q.QUARTERLY:return e.add(3,"month");case Q.HALF_YEARLY:return e.add(6,"month");case Q.YEARLY:return e.add(1,"year");case Q.TWO_YEARLY:return e.add(2,"year");case Q.THREE_YEARLY:return e.add(3,"year");default:return e}}),[r?.created_at,r?.period]),u=a.useMemo((()=>[{label:e("order.checkout.product-info-card.product-name"),value:r?.plan.name},{label:e("order.checkout.product-info-card.product-type"),value:e("order.checkout.product-info-card.product-period",{context:r?.period})},{label:e("order.checkout.product-info-card.traffic"),value:e("order.checkout.product-info-card.traffic",{count:r?.plan.transfer_enable||0,context:null===r?.plan.transfer_enable?"unlimited":"limited"})},...r?.period===Q.ONETIME?[]:[{label:e("order.checkout.product-info-card.next-billing-date"),value:s.format("YYYY/MM/DD")}]]),[r,e,s]);return o(R,{title:e("order.checkout.product-info-card.title"),children:o(d,{container:!0,spacing:1,children:u.map(((e,r)=>o(d,{item:!0,xs:12,children:i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:4,children:e.label}),o(d,{item:!0,xs:8,children:c?o(l,{variant:"text",width:"100%"}):e.value})]})},r)))})})},B=T()(((e,{status:r})=>({root:{padding:e.spacing(1)},icon:{fontSize:e.spacing(8),color:e.palette[r===K.FINISHED?"success":"warning"].main}}))),X=()=>{const{t:e}=t(),{status:r}=U(),{classes:c}=B({status:r}),n=a.useMemo((()=>{switch(r){case K.FINISHED:return o(h,{className:c.icon});case K.CANCELLED:return o(u,{className:c.icon});case K.PENDING:return o(s,{className:c.icon});default:return null}}),[r]),d=a.useMemo((()=>{switch(r){case K.FINISHED:return"finished";case K.CANCELLED:return"cancelled";case K.PAID:return"paid";default:return null}}),[r]);return o(R,{className:c.root,children:i(m,{direction:"column",spacing:3,children:[n,i(m,{direction:"column",spacing:1,alignItems:"center",children:[o(p,{variant:"h3",children:e("order.checkout.status-card.status",{context:d})}),o(p,{variant:"body1",color:"textSecondary",align:"center",children:e("order.checkout.status-card.description",{context:d})})]})]})})},Z=()=>{const{t:e}=t(),[r,{setLeft:a,setRight:n}]=b(!1),{tradeNo:d}=U(),[l]=O(),{enqueueSnackbar:s}=c(),u=f((async()=>{try{const r=await l(d).unwrap();r?(s(e("notice::order-cancel_success"),{variant:"success"}),D.event("order_cancel",{category:"order",label:"cancel",tradeNo:d,success:!0})):(s(e("notice::order-cancel_failed"),{variant:"error"}),D.event("order_cancel",{category:"order",label:"cancel",tradeNo:d,success:!1,error:r}))}catch(r){console.error("error when cancel order:",r),s(e("notice::order-cancel_failed"),{variant:"error"}),D.event("order_cancel",{category:"order",label:"cancel",tradeNo:d,success:!1,error:r})}a()}));return i(g,{children:[o(v,{title:e("order.checkout.order-info-card.cancel-tooltip"),placement:"top",children:o(k,{onClick:n,children:o(y,{})})}),i(N,{open:r,onClose:a,children:[o(x,{children:o(m,{direction:"row",alignItems:"center",spacing:1.5,children:o(p,{variant:"inherit",children:e("order.checkout.order-info-card.cancel-dialog.title")})})}),o(E,{}),o(_,{children:o(I,{children:e("order.checkout.order-info-card.cancel-dialog.content")})}),i(M,{children:[o(S,{onClick:a,children:e("order.checkout.order-info-card.cancel-dialog.cancel-button")}),o(S,{variant:"contained",color:"primary",onClick:u,children:e("order.checkout.order-info-card.cancel-dialog.confirm-button")})]})]})]})},$=()=>{const{t:e}=t(),{detail:{data:r,isLoading:c},status:s}=U(),u=a.useMemo((()=>{switch(s){case K.FINISHED:return"paid";case K.CANCELLED:return"cancelled";case K.PENDING:return"pending";default:return null}}),[s]),h=a.useMemo((()=>[{label:e("order.checkout.order-info-card.order-number"),value:r?.trade_no},{label:e("order.checkout.order-info-card.order-date"),value:n.unix(r?.created_at||0).format("YYYY-MM-DD HH:mm:ss")},{label:e("order.checkout.order-info-card.order-status"),value:e("order.checkout.order-info-card.order-status-value",{context:u})},...r?.discount_amount?[{label:e("order.checkout.order-info-card.coupon-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.discount_amount||0)/100).toFixed(2)})}]:[],...r?.surplus_amount?[{label:e("order.checkout.order-info-card.subscription-deduct-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.surplus_amount||0)/100).toFixed(2)})}]:[],{label:e("order.checkout.order-info-card.order-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.total_amount||0)/100).toFixed(2)})}]),[r,e]);return o(R,{title:e("order.checkout.order-info-card.title"),secondary:s===K.PENDING&&o(Z,{}),children:o(d,{container:!0,spacing:2,children:h.map(((e,r)=>o(d,{item:!0,xs:12,children:i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:4,children:e.label}),o(d,{item:!0,xs:8,children:o(p,{variant:"body1",noWrap:!0,children:c?o(l,{variant:"text",width:"100%"}):e.value})})]})},r)))})})},ee=T()((e=>({icon:{fontSize:e.spacing(2.5)}}))),re=()=>{const{t:e}=t(),{paymentMethod:{isLoading:r},detail:{isLoading:c},paymentMethodIndex:n,paymentMethodState:d,setPaymentMethodState:s,isSubmitting:u}=U(),h=a.useMemo((()=>Array.from(n.values())),[n]),{classes:m}=ee(),p=a.useCallback((({icon:e})=>!0===e.includes("alipay")?o(q,{type:"combined",children:o(w,{className:m.icon})}):o(q,{type:"combined",color:"secondary",src:e})),[]),b=e=>r=>{r.preventDefault(),s(e.id),D.event("select",{category:"order",label:"payment_method",method:n.get(e.id)?.name,method_id:e.id})};return o(R,{title:e("order.checkout.payment-method-card.title"),content:!1,children:o(L,{sx:{p:0},children:r||c?Array.from(new Array(3)).map(((e,r)=>o(Y,{disablePadding:!0,divider:!0,children:o(A,{disabled:!0,children:o(C,{children:o(l,{variant:"text",width:100})})})},r))):h.map((e=>o(Y,{disablePadding:!0,divider:!0,children:i(A,{selected:d===e.id,disabled:u,onClick:b(e),onTouchEnd:b(e),children:[e.icon&&o(P,{children:o(p,{icon:e.icon})}),o(C,{children:e.name})]})},e.id)))})})},te=()=>{const{t:e}=t(),{detail:{data:r,isLoading:n},paymentMethodState:d,paymentMethodIndex:s,setSubmitting:u,isSubmitting:h}=U(),[b]=z(),{enqueueSnackbar:f}=c(),g=a.useMemo((()=>[{label:r?.plan.name,value:e("order.checkout.billing-card.price",{value:Number((r?.plan[r?.period]??0)/100).toFixed(2)})},...r?.discount_amount||r?.surplus_amount?[{label:e("order.checkout.billing-card.deduction"),value:e("order.checkout.billing-card.price",{value:(((r?.discount_amount??0)+(r?.surplus_amount??0))/-100).toFixed(2)})}]:[],{label:e("order.checkout.billing-card.total-price"),value:e("order.checkout.billing-card.price",{value:Number((r?.total_amount??0)/100).toFixed(2)})}]),[r,e]),v=a.useCallback((async t=>{if(t.preventDefault(),r&&d)try{u(!0),D.event("click",{category:"order",label:"checkout",method:s.get(d)?.name,method_id:d}),window.location.href=await b({trade_no:r.trade_no,method:d}).unwrap()}catch(c){console.error(c),f(e("notice::checkout-failed"),{variant:"error"}),D.event("click",{category:"order",label:"checkout",method:s.get(d)?.name,method_id:d,success:!1,error:c})}finally{u(!1)}else f(e("notice::data-not-loaded"),{variant:"error"})}),[b,r,d]);return o(R,{title:e("order.checkout.billing-card.title"),children:i(m,{spacing:2,divider:o(E,{}),children:[g.map(((e,r)=>n?o(l,{variant:"text",width:"100%",height:40},r):i(m,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[o(p,{variant:"body1",children:e.label}),o(p,{variant:"body1",children:e.value})]},r))),o(S,{fullWidth:!0,variant:"contained",disabled:n||h,onClick:v,children:e("order.checkout.billing-card.button")})]})})},ce=()=>{const{status:e}=U();return i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:!0,children:i(d,{container:!0,spacing:2,children:[e!==K.PENDING&&o(d,{item:!0,xs:12,children:o(X,{})}),o(d,{item:!0,xs:12,children:o(V,{})}),o(d,{item:!0,xs:12,children:o($,{})}),e===K.PENDING&&o(d,{item:!0,xs:12})]})}),e===K.PENDING&&o(d,{item:!0,xs:12,md:4,children:i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:12,children:o(re,{})}),o(d,{item:!0,xs:12,children:o(te,{})})]})})]})};e("default",(()=>{W("checkout");const e=F().id;return o(r,{tradeNo:e||"",children:o(ce,{})})}))}}}));
